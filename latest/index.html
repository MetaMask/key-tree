<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@metamask/key-tree</title><meta name="description" content="Documentation for @metamask/key-tree"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@metamask/key-tree</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@metamask/key-tree</h1></div><div class="tsd-panel tsd-typography"><a id="md:metamaskkey-tree" class="tsd-anchor"></a><h1 class="tsd-anchor-link">@metamask/key-tree<a href="#md:metamaskkey-tree" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>An interface over <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a>, <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" class="external">BIP-32</a>, and <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a> key derivation paths.</p>
<p>This library was audited by Cure53 in February 2023, and April 2024. The audit reports can be found <a href="./audits">here</a>.</p>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>yarn add @metamask/key-tree</code></p>
<p>or</p>
<p><code>npm install @metamask/key-tree</code></p>
<a id="md:usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage<a href="#md:usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This package is designed to accommodate the creation of keys for any level of a <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a> or <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a> path.
Recall that a <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a> HD tree path consists of the following nodes (and depths):</p>
<blockquote>
<p><code>m / 44' / coin_type' / account' / change / address_index</code></p>
<p><code>0 / 1 / 2 / 3 / 4 / 5</code></p>
</blockquote>
<p>Where <code>m</code> is the &quot;master&quot; or seed node, <code>coin_type</code> indicates the protocol for which deeper keys are intended,
and <code>address_index</code> usually furnishes key pairs intended for user addresses / accounts.
For details, refer to the <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a> specification.
For the authoritative list of protocol <code>coin_type</code> indices, see <a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md" target="_blank" class="external">SLIP-44</a>.</p>
<p>The <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a> interface provides a more generic way for deriving keys, which is not constrained to the <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a> path
nodes. Currently only Secp256k1 and Ed25519 are supported for <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a>, but NIST P-256 may be added if there is
sufficient demand for it.</p>
<p>This package exports a few classes intended to facilitate the creation of keys in contexts with different privileges.
They are used as follows.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">BIP44CoinTypeNode</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@metamask/key-tree&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Per SLIP-44, Ethereum has a coin_type of 60.</span><br/><span class="hl-4">// Ethereum is only used by way of example.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">coinType</span><span class="hl-1"> = </span><span class="hl-7">60</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Imagine that this takes place in some privileged context with access to</span><br/><span class="hl-4">// the user&#39;s secret recovery phrase.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">secretRecoveryPhrase</span><span class="hl-1"> = </span><span class="hl-8">getSecretRecoveryPhrase</span><span class="hl-1">();</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">coinTypeNode</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">BIP44CoinTypeNode</span><span class="hl-1">.</span><span class="hl-8">fromDerivationPath</span><span class="hl-1">([</span><br/><span class="hl-1">  </span><span class="hl-3">`bip39:</span><span class="hl-5">${</span><span class="hl-2">secretRecoveryPhrase</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">`bip32:44&#39;`</span><span class="hl-1">, </span><span class="hl-4">// By BIP-44, the &quot;purpose&quot; node must be &quot;44&#39;&quot;</span><br/><span class="hl-1">  </span><span class="hl-3">`bip32:</span><span class="hl-5">${</span><span class="hl-2">coinType</span><span class="hl-5">}</span><span class="hl-3">&#39;`</span><span class="hl-1">,</span><br/><span class="hl-1">]);</span><br/><br/><span class="hl-4">// Imagine that this is some Node.js stream, but it could be anything that</span><br/><span class="hl-4">// can transmit JSON messages, such as window.postMessage.</span><br/><span class="hl-4">// Alternatively you can use `coinTypeNode.extendedKey` as well.</span><br/><span class="hl-2">stream</span><span class="hl-1">.</span><span class="hl-8">write</span><span class="hl-1">(</span><span class="hl-2">coinTypeNode</span><span class="hl-1">.</span><span class="hl-8">toJSON</span><span class="hl-1">());</span><br/><br/><span class="hl-4">//===============================</span><br/><span class="hl-4">// Then, on the receiving end...</span><br/><span class="hl-4">//===============================</span><br/><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">getBIP44AddressKeyDeriver</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@metamask/key-tree&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Get the node sent from the privileged context.</span><br/><span class="hl-4">// It will have the following shape:</span><br/><span class="hl-4">//   {</span><br/><span class="hl-4">//     privateKey, // A hexadecimal string of the private key</span><br/><span class="hl-4">//     publicKey, // A hexadecimal string of the public key</span><br/><span class="hl-4">//     chainCode, // A hexadecimal string of the chain code</span><br/><span class="hl-4">//     depth, // The number 2, which is the depth of coin_type nodes</span><br/><span class="hl-4">//     parentFingerprint, // The fingerprint of the parent node as number</span><br/><span class="hl-4">//     index, // The index of the node as number</span><br/><span class="hl-4">//     coin_type, // In this case, the number 60</span><br/><span class="hl-4">//     path, // For visualization only. In this case: m / 44&#39; / 60&#39;</span><br/><span class="hl-4">//   }</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">coinTypeNode</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-8">getCoinTypeNode</span><span class="hl-1">();</span><br/><br/><span class="hl-4">// Get an address key deriver for the coin_type node.</span><br/><span class="hl-4">// In this case, its path will be: m / 44&#39; / 60&#39; / 0&#39; / 0 / address_index</span><br/><span class="hl-4">// Alternatively you can use an extended key (`xprv`) as well.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">addressKeyDeriver</span><span class="hl-1"> = </span><span class="hl-8">getBIP44AddressKeyDeriver</span><span class="hl-1">(</span><span class="hl-2">coinTypeNode</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// These are Uint8Array representations of the extended private keys for</span><br/><span class="hl-4">// the respective addresses.</span><br/><br/><span class="hl-4">// m / 44&#39; / 60&#39; / 0&#39; / 0 / 0</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">addressKey0</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-8">addressKeyDeriver</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// m / 44&#39; / 60&#39; / 0&#39; / 0 / 1</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">addressKey1</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-8">addressKeyDeriver</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// m / 44&#39; / 60&#39; / 0&#39; / 0 / 2&#39;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">addressKey2</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-8">addressKeyDeriver</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Now, the extended private keys can be used to derive the corresponding public</span><br/><span class="hl-4">// keys and protocol addresses.</span>
</code><button type="button">Copy</button></pre>

<p>You can derive SLIP-10 keys as follows.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">SLIP10Node</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@metamask/key-tree&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create a SLIP10Node from a derivation path. You can also specify a key and depth instead.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">node</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">SLIP10Node</span><span class="hl-1">.</span><span class="hl-8">fromDerivationPath</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">curve:</span><span class="hl-1"> </span><span class="hl-3">&#39;secp256k1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">derivationPath:</span><span class="hl-1"> [</span><span class="hl-3">`bip39:</span><span class="hl-5">${</span><span class="hl-2">secretRecoveryPhrase</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-3">`slip10:0&#39;`</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// SLIP-10 supports Ed25519 as well.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">ed25519Node</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">SLIP10Node</span><span class="hl-1">.</span><span class="hl-8">fromDerivationPath</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">curve:</span><span class="hl-1"> </span><span class="hl-3">&#39;ed25519&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">derivationPath:</span><span class="hl-1"> [</span><span class="hl-3">`bip39:</span><span class="hl-5">${</span><span class="hl-2">secretRecoveryPhrase</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-3">`slip10:0&#39;`</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// Derive the child node at m / 0&#39; / 1&#39; / 2&#39;. This results in a new SLIP10Node.</span><br/><span class="hl-4">// Note that you cannot derive unhardened child nodes when using Ed25519.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">childNode</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">node</span><span class="hl-1">.</span><span class="hl-8">derive</span><span class="hl-1">([</span><span class="hl-3">`slip10:1&#39;`</span><span class="hl-1">, </span><span class="hl-3">`slip10:2&#39;`</span><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>SLIP10Node</code> class supports both <code>bip32:</code> and <code>slip10:</code> paths. While <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" class="external">BIP-32</a> and <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a> are mostly compatible with
each other, there are some differences:</p>
<ul>
<li>Ed25519 is only supported by <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a>, so you must use <code>slip10:</code> paths when deriving Ed25519 keys.</li>
<li>Key derivation errors (i.e., invalid keys being derived) are handled slightly different. While the chance of
encountering such an error is extremely low, it is possible.</li>
</ul>
<p>If you require full compatibility with one or the other, you can choose between the <code>bip32:</code> and <code>slip10:</code> path types.</p>
<p>There are other ways of deriving keys in addition to the above example.
See the docstrings in the <a href="media/BIP44Node.ts">BIP44Node</a>, <a href="media/BIP44CoinTypeNode.ts">BIP44CoinTypeNode</a> and
<a href="media/SLIP10Node.ts">SLIP10Node</a> files for details.</p>
<a id="md:internals" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Internals<a href="#md:internals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This package also has methods for deriving arbitrary <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a> and <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" class="external">BIP-32</a> keys, and generating seeds from <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" class="external">BIP-39</a>
secret recovery phrases.
These methods do not constitute a safe key derivation API, and their use is <strong>strongly discouraged</strong>.
Nevertheless, since those methods were the main exports of this package prior to version <code>3.0.0</code>, consumers can
still access them by importing <code>@metamask/key-tree/derivation</code>.</p>
<a id="md:security" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Security<a href="#md:security" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This package is rigorously tested against reference implementations and the <a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a> and <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" class="external">BIP-32</a> specifications.
See the <a href="media/reference-implementations.test.ts">reference implementation tests</a> for details.</p>
<a id="md:further-reading" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Further Reading<a href="#md:further-reading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" class="external">BIP-32</a></li>
<li><a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" class="external">BIP-39</a></li>
<li><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki" target="_blank" class="external">BIP-44</a></li>
<li><a href="https://github.com/satoshilabs/slips/blob/master/slip-0010.md" target="_blank" class="external">SLIP-10</a></li>
<li><a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md" target="_blank" class="external">SLIP-44</a></li>
<li>Network Working Group: <a href="https://trac.tools.ietf.org/html/draft-irtf-cfrg-kdf-uses-00" target="_blank" class="external">&quot;Key Derivation Functions and their Uses&quot;</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:metamaskkey-tree"><span>@metamask/key-<wbr/>tree</span></a><ul><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:internals"><span>Internals</span></a></li></ul></li><li><a href="#md:security"><span>Security</span></a></li><li><a href="#md:further-reading"><span>Further <wbr/>Reading</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@metamask/key-tree</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer></footer><div class="overlay"></div></body></html>
